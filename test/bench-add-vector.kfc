;; Vector sum

(%testspec
 (%tags bench))

(module
  (extern time-s () -> float)

  (define (add-vectors xs ys)
    (kernel ((x xs) (y ys)) (+ x y)))
  
  (define (bench_length len)
    (let ((xs (make-vector len 1.0))
          (ys (make-vector len 1.0)))
      ;;(println* "Created vectors.")
      (let* ((start (nanotime))
             (sum (add-vectors xs ys))
             ;;(sum (kernel ((x xs) (y ys)) (+ x y)))
             (stop (nanotime)))
		(- stop start))))
    
  (define (main)
;;    (for (i 30 31)
    (for (i 1 90 2)
;;    (for (i 1 17)
	  (let ((time 0))
		(for (j 0 10)
		  (set! time (+ time (bench_length (* i 1000000)))))
        (println* i "\t" (/ (u64->float (/ time 1000)) 1e7))))
    ;;  (print i)
	;;	(print "\nSELFTIMED: ")
	;;	(println (/ (u64->float (/ time 1000)) 1e7))))
    0))
